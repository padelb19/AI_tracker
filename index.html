<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI-tracker</title>
  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Global styles */
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: white;
    }
    header {
      width: 100%;
      background-color: #f2f2f2;
      padding: 10px;
    }
    /* 3-column flex container for logo (left), title (center), optional right block */
    .header-top {
      display: flex;
      align-items: center;
    }
    .left-block, .center-block, .right-block {
      flex: 1;
      min-height: 50px;
    }
    .left-block {
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }
    .logo {
      height: 40px;
      margin-left: 10px;
    }
    .center-block {
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .center-block h1 {
      margin: 0;
      font-size: 1.8em;
    }
    .right-block {
      /* empty placeholder if needed */
    }
    /* Navigation bar below the top bar */
    nav {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }
    nav button {
      padding: 10px 20px;
      cursor: pointer;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    nav button:hover {
      background-color: #eee;
    }

    .page {
      display: none; /* all pages hidden by default; only the active one is shown */
      padding: 20px;
    }
    .active {
      display: block;
    }

    /* Accueil Page */
    #accueil h2 {
      text-align: center;
      margin-top: 30px;
    }
    .explanation {
      max-width: 800px;
      margin: 30px auto;
      text-align: center;
      font-size: 1em;
      line-height: 1.4em;
    }
    .additional-figures {
      max-width: 1000px;
      margin: 40px auto;
    }
    .additional-figures h3 {
      text-align: center;
      margin-bottom: 20px;
    }
    .figures-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-bottom: 40px;
    }
    .key-figure-card {
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 20px;
      width: 200px;
      text-align: center;
      background-color: #fff;
    }

    /* Dashboards Page */
    #dashboards {
      margin: 0 auto;
      max-width: 1000px;
    }
    #dashboards h2 {
      margin-bottom: 10px;
      text-align: center;
    }
    .sub-nav {
      text-align: center;
      margin-bottom: 20px;
    }
    .sub-nav button {
      margin: 5px;
      background-color: #fff;
      border: 1px solid #ccc;
      cursor: pointer;
      border-radius: 4px;
    }
    .chart-section {
      margin-bottom: 40px;
    }
    .chart-controls {
      margin: 10px 0;
      text-align: center;
    }
    .chart-container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }
    /* Smaller pie chart container */
    #adoptersSection .chart-container {
      max-width: 400px; /* Make the pie chart narrower */
    }

    /* Projects Page */
    #projects h2 {
      text-align: center;
      margin-bottom: 40px;
    }
    #projects section {
      max-width: 800px;
      margin: 0 auto 30px auto;
    }
    #projects section h3 {
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<header>
  <div class="header-top">
    <div class="left-block">
      <img src="logo.png" alt="AI-tracker logo" class="logo" />
    </div>
    <div class="center-block">
      <h1>AI-tracker</h1>
    </div>
    <div class="right-block"></div>
  </div>
  <nav>
    <button onclick="showPage('accueil')">Accueil</button>
    <button onclick="showPage('dashboards')">Dashboards</button>
    <button onclick="showPage('projects')">Projects</button>
  </nav>
</header>

<!-- ACCUEIL PAGE -->
<div id="accueil" class="page active">
  <h2>Welcome to the AI-tracker!</h2>
  <p style="text-align:center;">
    Here you can find insights into the evolution of AI adoption by French firms, based on their recruitment data.
  </p>
  
  <div class="explanation">
    This tracker is built using machine learning models on the JOCAS database, edited by the 
    French Ministry of Labor's DARES. By automatically detecting AI-related job offers, 
    the AI-tracker monitors the growing adoption of this technology within the French economy.
  </div>

  <!-- Additional Figures (Mock) -->
  <div class="additional-figures">
    <!-- AI Figures -->
    <h3>Additional Key Figures - AI</h3>
    <div class="figures-row">
      <div class="key-figure-card">
        <h4>Firms Having Recruited for AI (Total)</h4>
        <p>8,500 (mock)</p>
      </div>
      <div class="key-figure-card">
        <h4>New Recruiters Last Quarter</h4>
        <p>400 (mock)</p>
        <p><small>+5% vs. previous quarter (mock)</small></p>
      </div>
      <div class="key-figure-card">
        <h4>Number of AI Offers (Total)</h4>
        <p>45,000 (mock)</p>
      </div>
      <div class="key-figure-card">
        <h4>AI Offers Last Quarter</h4>
        <p>6,000 (mock)</p>
        <p><small>+10% vs. previous quarter (mock)</small></p>
      </div>
    </div>

    <!-- Generative AI Figures -->
    <h3>Additional Key Figures - Generative AI</h3>
    <div class="figures-row">
      <div class="key-figure-card">
        <h4>Firms Having Recruited for Generative AI (Total)</h4>
        <p>2,000 (mock)</p>
      </div>
      <div class="key-figure-card">
        <h4>New Recruiters Last Quarter</h4>
        <p>150 (mock)</p>
        <p><small>+8% vs. previous quarter (mock)</small></p>
      </div>
      <div class="key-figure-card">
        <h4>Number of Generative AI Offers (Total)</h4>
        <p>20,000 (mock)</p>
      </div>
      <div class="key-figure-card">
        <h4>Generative AI Offers Last Quarter</h4>
        <p>2,000 (mock)</p>
        <p><small>+12% vs. previous quarter (mock)</small></p>
      </div>
    </div>
  </div>
</div>

<!-- DASHBOARDS PAGE -->
<div id="dashboards" class="page">
  <h2>Dashboards</h2>
  <div class="sub-nav">
    <button onclick="scrollToSection('totalOffersSection')">Total Offers</button>
    <button onclick="scrollToSection('sectorsSection')">Sectors</button>
    <button onclick="scrollToSection('locationSection')">Location</button>
    <button onclick="scrollToSection('adoptersSection')">Adopters</button>
  </div>

  <!-- 1) Evolution of total AI offers (csv-based) -->
  <div id="totalOffersSection" class="chart-section">
    <h3>Evolution of AI-Related Job Offers</h3>
    <div class="chart-controls">
      <button onclick="toggleTotalShare('offersChart')">Toggle Total / Share</button><br/><br/>
    </div>
    <div class="chart-container">
      <canvas id="offersChart"></canvas>
    </div>
  </div>

  <!-- 2) Firms adopting AI by sector (mock) -->
  <div id="sectorsSection" class="chart-section">
    <h3>Firms Adopting AI by Sector</h3>
    <p>(Mock example)</p>
    <div class="chart-container">
      <canvas id="sectorsChart"></canvas>
    </div>
  </div>

  <!-- 3) Ranking of French Zones d’emploi (mock) -->
  <div id="locationSection" class="chart-section">
    <h3>Ranking of French Zones d’Emplois</h3>
    <p>(Mock example for demonstration)</p>
    <div class="chart-container">
      <canvas id="zonesChart"></canvas>
    </div>
  </div>

  <!-- 4) Composition of AI adopters (mock) -->
  <div id="adoptersSection" class="chart-section">
    <h3>Composition of AI Adopters</h3>
    <p>(Mock example)</p>
    <div class="chart-container">
      <canvas id="adoptersChart"></canvas>
    </div>
  </div>
</div>

<!-- PROJECTS PAGE -->
<div id="projects" class="page">
  <h2>Projects</h2>
  <section class="authors">
    <h3>Authors</h3>
    <p>This AI-tracker is developed by three economists:</p>
    <ul>
      <li>Paul Delbouve</li>
      <li>Philippe Aghion</li>
      <li>Antonin Bergeaud</li>
    </ul>
  </section>
  <section class="papers">
    <h3>Academic Papers</h3>
    <p>
      Here you will find academic papers linked with this website and ongoing research projects related to AI adoption.
      <br /><br />
      <strong>Paper 1:</strong> <em>Title and Link (mock)</em><br />
      <strong>Paper 2:</strong> <em>Title and Link (mock)</em>
    </p>
  </section>
</div>

<script>
  /****************************************************
   * Page Navigation
   ****************************************************/
  function showPage(pageId) {
    const pages = document.querySelectorAll('.page');
    pages.forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
  }

  function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (!section) return;
    showPage('dashboards');
    section.scrollIntoView({ behavior: 'smooth' });
  }

  /****************************************************
   * Minimal CSV fetching & parsing
   ****************************************************/
  async function fetchCsv(url) {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Failed to fetch ${url}`);
    }
    return await response.text();
  }

  function parseCsv(csvText) {
    // skip the first line (header), then parse each subsequent line
    const lines = csvText.trim().split('\n');
    const rows = [];
    for (let i = 1; i < lines.length; i++) {
      rows.push(lines[i].split(',')); // columns
    }
    return rows;
  }

  /****************************************************
   * QUARTER LABELS from "index"
   * e.g. 0 -> Q1 2019, 1 -> Q2 2019, 2 -> Q3 2019, etc.
   ****************************************************/
  function quarterLabelFromIndex(i) {
    const baseYear = 2019;
    const year = baseYear + Math.floor(i / 4);
    const quarter = (i % 4) + 1;
    return `Q${quarter} ${year}`;
  }

  /****************************************************
   * Data arrays for the FIRST CHART (Offers)
   ****************************************************/
  let quarterLabels = [];
  let totalDataOffersGen = [];
  let totalDataOffersGeneral = [];
  let totalDataOffersCV = [];

  let shareDataOffersGen = [];
  let shareDataOffersGeneral = [];
  let shareDataOffersCV = [];

  let offersChart;
  let offersMode = 'total'; // or 'share'

  /****************************************************
   * Toggle function: "Total" <-> "Share"
   ****************************************************/
  function toggleTotalShare(chartName) {
    if (chartName === 'offersChart') {
      offersMode = (offersMode === 'total') ? 'share' : 'total';
      if (offersMode === 'total') {
        offersChart.data.datasets[0].data = totalDataOffersGen;
        offersChart.data.datasets[1].data = totalDataOffersGeneral;
        offersChart.data.datasets[2].data = totalDataOffersCV;
      } else {
        offersChart.data.datasets[0].data = shareDataOffersGen;
        offersChart.data.datasets[1].data = shareDataOffersGeneral;
        offersChart.data.datasets[2].data = shareDataOffersCV;
      }
      offersChart.update();
    }
  }

  /****************************************************
   * 1) OFFERS CHART creation
   ****************************************************/
  function createOffersChart() {
    const ctx = document.getElementById("offersChart").getContext("2d");
    offersChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: quarterLabels,
        datasets: [
          {
            label: 'IA Générative',
            data: totalDataOffersGen, // start in total mode
            backgroundColor: 'rgba(255, 99, 132, 0.7)'
          },
          {
            label: 'IA Générale',
            data: totalDataOffersGeneral,
            backgroundColor: 'rgba(75, 192, 192, 0.7)'
          },
          {
            label: 'Computer Vision',
            data: totalDataOffersCV,
            backgroundColor: 'rgba(54, 162, 235, 0.7)'
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          title: { display: false },
          tooltip: { mode: 'index', intersect: false }
        },
        scales: {
          x: { stacked: true },
          y: { stacked: true }
        }
      }
    });
  }

  /****************************************************
   * 2) SECTORS CHART (mock)
   ****************************************************/
  let sectorsChart;
  function createSectorsChart() {
    const ctx = document.getElementById("sectorsChart").getContext("2d");
    sectorsChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ["2019", "2020", "2021"],
        datasets: [
          {
            label: 'Industrie',
            data: [100, 120, 130],
            backgroundColor: 'rgba(153, 102, 255, 0.7)'
          },
          {
            label: 'Service',
            data: [80, 100, 140],
            backgroundColor: 'rgba(255, 205, 86, 0.7)'
          }
        ]
      },
      options: {
        responsive: true
      }
    });
  }

  /****************************************************
   * 3) ZONES CHART (mock)
   ****************************************************/
  let zonesChart;
  function createZonesChart() {
    const ctx = document.getElementById("zonesChart").getContext("2d");
    zonesChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ["Paris", "Lyon", "Marseille"],
        datasets: [
          {
            label: 'IA Offers',
            data: [500, 300, 200],
            backgroundColor: 'rgba(255, 159, 64, 0.7)'
          }
        ]
      },
      options: {
        indexAxis: 'y',
        responsive: true
      }
    });
  }

  /****************************************************
   * 4) ADOPTERS CHART (mock)
   ****************************************************/
  let adoptersChart;
  function createAdoptersChart() {
    const ctx = document.getElementById("adoptersChart").getContext("2d");
    adoptersChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ["PME", "ETI", "GE"],
        datasets: [
          {
            label: 'Composition of AI Adopters',
            data: [50, 30, 20],
            backgroundColor: [
              'rgba(54, 162, 235, 0.7)',
              'rgba(255, 206, 86, 0.7)',
              'rgba(75, 192, 192, 0.7)'
            ]
          }
        ]
      },
      options: {
        responsive: true
      }
    });
  }

  /****************************************************
   * On window load: fetch your total & share CSV, parse them, build charts
   ****************************************************/
  window.onload = async function() {
    try {
      /*
        CSV #1: offers_total.csv with columns:
        index,ia générative,ia générale,cv
        e.g.
        0,2,181,40
        1,2,195,53
        2,6,752,195
        ...
        72,...
      */
      const totalCsv = await fetchCsv('data/offers_total.csv');
      const totalRows = parseCsv(totalCsv);
      for (let row of totalRows) {
        // row = ["0","2","181","40"]
        const idx = parseInt(row[0]);
        const valGen = parseFloat(row[1]);       // ia générative
        const valGeneral = parseFloat(row[2]);   // ia générale
        const valCV = parseFloat(row[3]);        // cv

        // Convert index to "Q1 2019", "Q2 2019", etc.
        quarterLabels.push( quarterLabelFromIndex(idx) );

        totalDataOffersGen.push(valGen);
        totalDataOffersGeneral.push(valGeneral);
        totalDataOffersCV.push(valCV);
      }

      /*
        CSV #2: offers_share.csv with columns:
        index,ia générative,ia générale,cv
        e.g.
        0,0.000239052,0.0216342,0.004781
        1,0.000215289,0.0209906,0.005705
        ...
        72,...
      */
      const shareCsv = await fetchCsv('data/offers_share.csv');
      const shareRows = parseCsv(shareCsv);
      for (let row of shareRows) {
        // row = ["0","0.000239052","0.0216342","0.004781"]
        shareDataOffersGen.push( parseFloat(row[1]) );
        shareDataOffersGeneral.push( parseFloat(row[2]) );
        shareDataOffersCV.push( parseFloat(row[3]) );
      }

      // Now create the charts
      createOffersChart();
      createSectorsChart();
      createZonesChart();
      createAdoptersChart();

    } catch (err) {
      console.error("Error loading CSV data:", err);
    }
  };
</script>
</body>
</html>
